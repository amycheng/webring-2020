<html>
<head>
<title>2020 Webring</title>
<style>
  .embed-code-cta {
    margin: 0 auto;
    width: 800px;
  }
  .webring {
    margin: 0 auto;
  }
</style>
</head>
  <body>
    <div class="embed-code-wrapper">
      <aside id="mech-keyboard-webring" class="webring">
        <link href="https://fonts.googleapis.com/css?family=Baloo+Thambi" rel="stylesheet">
        <link id="embed-style" rel="stylesheet" href="/assets/embed-style.css">
        <div class="webring-container">
          <h2 class="webring-title">Mechanical Keyboard Appreciation WebRing</h2>
          <picture class="webring-image">
            <img src="https://media.giphy.com/media/LHZyixOnHwDDy/giphy-downsized.gif" alt="">
          </picture>
          <nav class="webring-navigation">
            <a class="previous webring-link" href="redirect.html?action=prev&">Previous</a>
            <a class="next webring-link" href="redirect.html?action=next&">Next</a>
            <a class="random webring-link" href="redirect.html?action=random&">Random</a>
            <a class="list webring-link" href="list.html?">List Sites</a>
          </nav>
          <p class="webring-join-copy">To join this webring: @ <a href="https://twitter.com/am3thyst">Amy</a> on Twitter</p>
        </div>
      </aside>
    </div>

  <div class="embed-code-cta">
    <div class="generate-embed">
      <p>Enter your url. Include http</p>
      <input type="text" class="member-url" placeholder="your page url">
      <button class="generate-btn">Generate Embed Code</button>
    </div>
    <div class="generated-embed-code">
      <h2>Grab the embed code!</h2>
      <textarea class="embed-code" rows="4" cols="50"></textarea>
      <button class="copy-btn">Copy!</button>
    </div>
  </div>


  <script type="text/javascript">
    const buttonEls = document.querySelectorAll('.embed-code-wrapper .webring-link');
    const copyBtnEl = getEl('.copy-btn');
    const embedSourceCodeEl = getEl('.embed-code');
    const generateBtnEl = getEl('.generate-btn');

    function getEl(el){
      return document.querySelector(el);
    }

    function copyCode() {
      embedSourceCodeEl.select();
      document.execCommand('copy');
      copyBtnEl.innerHTML = 'Copied!';
    }

    function customizeEmbedCode(){
      const stylesheet = document.getElementById('embed-style');
      const styleSheetSRC = stylesheet.getAttribute('src');
      const webringHost = window.location.host + '/';

      buttonEls.forEach(($el)=>{
        const newHREF = `${window.location.protocol}//${webringHost}${$el.getAttribute('href')}`;
        console.log(newHREF);
        $el.setAttribute('href', newHREF);
      });

      stylesheet.setAttribute('src', `${webringHost}${styleSheetSRC}`);
    }

    function generateEmbedCode() {
      const memberUrl= encodeURIComponent(getEl('.member-url').value);

      if(memberUrl.length){
        buttonEls.forEach(($el)=>{
          const newHREF = `${$el.getAttribute('href')}member=${memberUrl}`;
          $el.setAttribute('href',newHREF);
        });

        embedSourceCodeEl.innerHTML = getEl('.embed-code-wrapper').innerHTML.toString();
        generateBtnEl.innerHTML = 'embed code generated!';
      }
    }

    function addHandlers(){
      generateBtnEl.addEventListener('click',generateEmbedCode);
      copyBtnEl.addEventListener('click', copyCode)
    }

    customizeEmbedCode();
    addHandlers();

  </script>
  </body>
</html>